<!-- src/components/NewsWidget.astro -->
<div id="tradingview-news-widget-container" class="tradingview-widget-container mb-4">
</div>

<script is:inline>
    function initializeNewsWidget() {
        const theme = localStorage.getItem('theme') || 'dark';
        const container = document.getElementById('tradingview-news-widget-container');
        if (!container) return;

        // Clear previous widget if any
        container.innerHTML = '';

        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-timeline.js';
        script.async = true;

        const config = {
          "feedMode": "all_symbols",
          "isTransparent": false,
          "displayMode": "regular",
          "width": "100%",
          "height": 550,
          "colorTheme": theme,
          "locale": "en"
        };

        script.innerHTML = JSON.stringify(config);
        container.appendChild(script);
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initializeNewsWidget);
    
    // Re-initialize when theme changes
    window.addEventListener('storage', (e) => {
        if (e.key === 'theme') {
            initializeNewsWidget();
        }
    });
</script>
