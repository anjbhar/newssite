<!-- src/components/TradingViewWidget.astro -->
<div id="tradingview-widget-container" class="tradingview-widget-container">
  <div class="tradingview-widget-container__widget"></div>
  <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>
</div>

<script is:inline>
    function initializeWidget() {
        const theme = localStorage.getItem('theme') || 'dark';
        const container = document.getElementById('tradingview-widget-container');
        if (!container) return;

        // Clear previous widget if any
        container.innerHTML = `
          <div class="tradingview-widget-container__widget"></div>
          <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>
        `;

        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js';
        script.async = true;

        const config = {
          "colorTheme": theme,
          "dateRange": "12M",
          "showChart": true,
          "locale": "en",
          "largeChartUrl": "",
          "isTransparent": false,
          "showSymbolLogo": true,
          "showFloatingTooltip": false,
          "width": "100%",
          "height": "660",
          "tabs": [
            {
              "title": "Indices",
              "symbols": [
                { "s": "FOREXCOM:SPXUSD", "d": "S&P 500" },
                { "s": "FOREXCOM:NSXUSD", "d": "US 100" },
                { "s": "FOREXCOM:DJI", "d": "Dow 30" },
                { "s": "INDEX:NKY", "d": "Nikkei 225" },
                { "s": "INDEX:DEU40", "d": "DAX Index" },
                { "s": "FOREXCOM:UKXGBP", "d": "UK 100" }
              ],
              "originalTitle": "Indices"
            },
            {
              "title": "Futures",
              "symbols": [
                { "s": "CME_MINI:ES1!", "d": "S&P 500" },
                { "s": "CME:6E1!", "d": "Euro" },
                { "s": "COMEX:GC1!", "d": "Gold" },
                { "s": "NYMEX:CL1!", "d": "Crude Oil" },
                { "s": "NASDAQ:NDX" },
                { "s": "CBOT:ZC1!", "d": "Corn" }
              ],
              "originalTitle": "Futures"
            },
            {
              "title": "Bonds",
              "symbols": [
                { "s": "CBOT:ZB1!", "d": "T-Bond" },
                { "s": "CBOT:UB1!", "d": "Ultra T-Bond" },
                { "s": "EUREX:FGBL1!", "d": "Euro Bund" },
                { "s": "EUREX:FBTP1!", "d": "Euro BTP" },
                { "s": "EUREX:FGBM1!", "d": "Euro BOBL" }
              ],
              "originalTitle": "Bonds"
            },
            {
              "title": "Forex",
              "symbols": [
                { "s": "FX:EURUSD", "d": "EUR/USD" },
                { "s": "FX:GBPUSD", "d": "GBP/USD" },
                { "s": "FX:USDJPY", "d": "USD/JPY" },
                { "s": "FX:USDCHF", "d": "USD/CHF" },
                { "s": "FX:AUDUSD", "d": "AUD/USD" },
                { "s": "FX:USDCAD", "d": "USD/CAD" }
              ],
              "originalTitle": "Forex"
            }
          ]
        };

        script.innerHTML = JSON.stringify(config);
        container.querySelector('.tradingview-widget-container__widget').appendChild(script);
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initializeWidget);
    
    // Re-initialize when theme changes
    window.addEventListener('storage', (e) => {
        if (e.key === 'theme') {
            initializeWidget();
        }
    });
</script>
